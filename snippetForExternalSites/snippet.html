<!DOCTYPE html>
<html lang="en">
<head>
<title>External Customer Site</title>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script src="http://127.0.0.1:3000/nowjs/now.js"></script>

<script>

(function ($) {
  var chatStatus = {};

  // The following callback is called by the server in order to
  // advertise its status.
  now.updateStatus = function (attributes) {
    chatStatus = attributes;
    
    $(window).trigger('opekaChatStatusUpdate', [attributes]);

  };

  // When the DOM is ready, set up the widget.
  $(function () {
    var statusText = $('#status');

    // Updates the actual status text.
    var updateDisplay = function (attributes) {
      // If there are any active one-to-one rooms.
      if (chatStatus.rooms.pair.active > 0) {
        statusText.text("Chat active");
      // If not, check if there are any active group rooms.
      } else if (chatStatus.rooms.pair.full > 0) {
        statusText.text("Chat busy");
      } else {
        statusText.text("Chat not active");
      };
    };

    // When the document is ready, update the status, and bind the event
    // to have it update automatically later.
    $(window).bind('opekaChatStatusUpdate', updateDisplay);
    
    // Run updateDisplay once manually so we have the initial text
    // nailed down.
    updateDisplay();
  });
}(jQuery));

</script>
</head>
<body>
  <div id="status">Chat not active</div>
</body>
</html>
