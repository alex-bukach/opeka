<!DOCTYPE html>
<html lang="en">
<head>
<title>nowjs test</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="/nowjs/now.js"></script>

<script>
$(document).ready(function(){

  function printElt(element, index, array) {
	//$("#rooms").append("<br>" + element);
	  $("#rooms").append("<a href=\"#\" onClick=\"now.changeRoom($(this).text());\">"+element.name+"</a><br>");
  }

  now.receiveRooms = function(rooms){
	document.getElementById('rooms').innerHTML = "Available rooms:<br>";
	if (rooms.length == 0)
		$("#rooms").append("No rooms available");
	else{
		rooms.forEach(printElt)
	}
  }

  now.receiveMessage = function(name, message){
    $("#chat").append("<br>" + name + ": " + message);
  }

  now.clearMessages = function(){
	document.getElementById('chat').innerHTML = "";	
  }
    
  $("#connect-button").click(function(){
	  now.name = $("#username-input").val();
      $("#username-input").val("");
	  now.newClientReady();
	  document.getElementById('connect').innerHTML = "";
  });

  $("#send-button").click(function(){
    now.distributeMessage($("#text-input").val());
    $("#text-input").val("");
  });

});

</script>
</head>

<body>

<div id="rooms">
	You are not connected.
</div>

<div id="chat">
</div>

<input type="text" id="text-input">
<input type="button" value="Send" id="send-button">

<div id="connect">
Username:
<input type="text" id="username-input">
<input type="button" value="Connect" id="connect-button">
</div>


</body>
</html>